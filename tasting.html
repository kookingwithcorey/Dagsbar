<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DAGS | Tasting Sheet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050608;
      --bg-alt: #11141a;
      --accent: #0f8b6b;
      --accent-soft: rgba(15, 139, 107, 0.3);
      --text: #f7f7f7;
      --muted: #a3acb9;
      --border: rgba(255, 255, 255, 0.12);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #202735 0, #050608 55%);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .page {
      width: 100%;
      max-width: 1100px;
      padding: 24px 16px 40px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-title {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .brand-subtitle {
      font-size: 0.8rem;
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.28em;
    }

    nav {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    nav a {
      font-size: 0.85rem;
      text-decoration: none;
      color: var(--muted);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid transparent;
      transition: all 0.18s ease;
    }

    nav a:hover {
      border-color: var(--border);
      color: var(--text);
      background: rgba(255, 255, 255, 0.02);
    }

    nav a.active {
      border-color: var(--accent-soft);
      background: rgba(15, 139, 107, 0.12);
      color: var(--text);
    }

    .card {
      background: rgba(10, 12, 18, 0.92);
      border-radius: 24px;
      border: 1px solid var(--border);
      padding: 20px 20px 24px;
      box-shadow: 0 18px 80px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "DAGS";
      position: absolute;
      right: 20px;
      bottom: 10px;
      font-size: 3.2rem;
      font-weight: 800;
      letter-spacing: 0.35em;
      color: rgba(255, 255, 255, 0.03);
      pointer-events: none;
      user-select: none;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .button-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    button,
    .btn-secondary {
      border-radius: 999px;
      padding: 8px 16px;
      border: 1px solid transparent;
      background: var(--accent);
      color: #fff;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.18s ease;
    }

    button:hover,
    .btn-secondary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .btn-secondary {
      background: transparent;
      border-color: var(--border);
      color: var(--muted);
    }

    .tasting-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.1fr);
      gap: 18px 20px;
      margin-top: 12px;
    }

    @media (max-width: 840px) {
      .tasting-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field-group {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: var(--muted);
    }

    input[type="text"],
    input[type="number"],
    textarea,
    select {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 7px 12px;
      font-size: 0.9rem;
      color: var(--text);
      outline: none;
      transition: border 0.18s ease, background 0.18s ease, box-shadow 0.18s ease;
      width: 100%;
    }

    textarea {
      border-radius: 16px;
      min-height: 70px;
      resize: vertical;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(15, 139, 107, 0.28);
      background: rgba(0, 0, 0, 0.75);
    }

    /* Darker dropdown / options so text is readable */
    select {
      background: rgba(0, 0, 0, 0.6);
      color: var(--text);
    }

    select option {
      background: #050608;
      color: var(--text);
    }

    .metrics-section,
    .notes-section {
      border-radius: 18px;
      border: 1px solid var(--border);
      padding: 12px 14px 14px;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.02), transparent 55%);
    }

    .section-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .metric-row {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 10px;
      align-items: center;
      margin-bottom: 6px;
    }

    .metric-label {
      font-size: 0.85rem;
      color: var(--text);
    }

    .metric-value {
      font-size: 0.8rem;
      color: var(--muted);
      text-align: right;
    }

    input[type="range"] {
      width: 100%;
      appearance: none;
      background: transparent;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 4px;
      background: linear-gradient(90deg, rgba(15, 139, 107, 0.8), rgba(255, 255, 255, 0.16));
      border-radius: 999px;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid var(--accent);
      margin-top: -6px;
      box-shadow: 0 0 0 3px rgba(15, 139, 107, 0.32);
    }

    input[type="range"]::-moz-range-track {
      height: 4px;
      background: linear-gradient(90deg, rgba(15, 139, 107, 0.8), rgba(255, 255, 255, 0.16));
      border-radius: 999px;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid var(--accent);
      box-shadow: 0 0 0 3px rgba(15, 139, 107, 0.32);
    }

    .notes-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 8px;
    }

    .notes-row {
      display: grid;
      grid-template-columns: 95px minmax(0, 1fr);
      gap: 10px;
      align-items: flex-start;
    }

    .notes-label-pill {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--muted);
      border-radius: 999px;
      border: 1px dashed rgba(255, 255, 255, 0.16);
      padding: 4px 8px;
      text-align: center;
      align-self: center;
    }

    .summary-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
      font-size: 0.75rem;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      padding: 2px 8px;
      color: var(--muted);
    }

    footer {
      margin-top: 14px;
      text-align: center;
      font-size: 0.75rem;
      color: var(--muted);
      opacity: 0.7;
    }

    /* --- Flavor profile / chart --- */

    .flavor-profile-header {
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 8px;
    }

    .flavor-profile-label {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .flavor-profile-title {
      margin-top: 4px;
      font-size: 1.1rem;
      font-weight: 700;
      color: #ff5f3b;
    }

    .flavor-chart {
      position: relative;
      margin: 4px -4px 18px;
      padding: 0 4px 26px;
      overflow: hidden;
    }

    /* watermark logo behind the line graph */
    .flavor-chart::before {
      content: "";
      position: absolute;
      inset: 8px 40px 40px;
      background: url("dags-new-logo.png") center/contain no-repeat;
      opacity: 0.06;
      pointer-events: none;
    }

    .flavor-chart svg {
      width: 100%;
      height: 150px;
      display: block;
      position: relative;
      z-index: 1;
    }

    .flavor-chart path.profile-line {
      fill: none;
      stroke: #ff5f3b;
      stroke-width: 4;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .flavor-chart line.profile-guide {
      stroke: rgba(255, 255, 255, 0.18);
      stroke-width: 1;
      stroke-dasharray: 3 3;
    }

    .flavor-chart line.profile-tick {
      stroke: rgba(255, 255, 255, 0.6);
      stroke-width: 1.4;
    }

    .flavor-chart circle.profile-point {
      r: 4;
      fill: #ff5f3b;
    }

    .flavor-chart-labels {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
      color: var(--muted);
      pointer-events: none;
      z-index: 2;
    }

    .flavor-chart-labels span {
      white-space: nowrap;
    }
   /* Print styles â€“ force one-page fit */
@media print {
  /* Control printer page size + margins */
  @page {
    size: letter portrait;       /* change to A4 if you prefer */
    margin: 0.25in;
  }

  body {
    background: #ffffff !important;
  }

  html,
  body {
    width: 100% !important;
    height: 100% !important;
    overflow: hidden !important;
  }

  /* Remove nav + buttons for print */
  header nav,
  .button-row,
  .brand-subtitle {
    display: none !important;
  }

  .page {
    max-width: 100% !important;
    padding: 0.2in 0.3in !important;  /* tighter padding to save space */
  }

  .card {
    box-shadow: none !important;
    border-radius: 0 !important;
    background: #ffffff !important;
    border-color: #dddddd !important;

    /* ðŸ‘‡ The magic: shrink slightly so the whole card fits on one page */
    transform: scale(0.90);
    transform-origin: top left;
  }

  input[type="text"],
  input[type="number"],
  textarea,
  select {
    background: #ffffff !important;
    color: #000000 !important;
    border-color: #bbbbbb !important;
    box-shadow: none !important;
  }

  label,
  .section-title,
  .metric-label,
  .notes-label-pill,
  footer {
    color: #333333 !important;
  }

  .summary-chip-row {
    border-top: 1px dashed #ccc;
    padding-top: 4px;
    margin-top: 6px;
  }

  .flavor-profile-title {
    color: #000000 !important;
  }

  .flavor-chart path.profile-line,
  .flavor-chart circle.profile-point,
  .flavor-chart line.profile-guide,
  .flavor-chart line.profile-tick {
    stroke: #000000 !important;
    fill: #000000 !important;
  }

  .flavor-chart::before {
    opacity: 0.04 !important;
  }

  /* Try very hard to prevent page breaks */
  * {
    page-break-before: avoid !important;
    page-break-after: avoid !important;
    page-break-inside: avoid !important;
  }
}

  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-title">DAGS</div>
        <div class="brand-subtitle">Bourbon & Whiskey Lounge</div>
      </div>
      <nav>
        <a href="index.html">Home</a>
        <a href="menu.html">Whiskey List</a>
        <a href="menu-print.html">Printable Menu</a>
        <a href="tasting.html" class="active">Tasting Sheet</a>
        <a href="blind-tasting.html">Blind Tasting</a>
      <a href="history.html">Whiskey Log Book</a>

      </nav>
    </header>

    <main class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Bourbon Tasting Sheet</div>
          <div class="card-subtitle">
            Fill this out live at the bar, then use your browserâ€™s print button (or the one below) for a clean one-page print.
          </div>
        </div>
       <div class="button-row">
  <button type="button" id="printBtn">Print Sheet</button>
  <button type="button" id="clearBtn" class="btn-secondary">Clear All</button>
  <button type="button" id="saveBtn" class="btn-secondary">Save Tasting</button>
</div>


      <form id="tastingForm" autocomplete="off">
        <div class="tasting-grid">
          <!-- LEFT COLUMN â€“ BASIC INFO, NOTES, OVERALL RATING -->
          <section>
            <div class="field-group">
              <div class="field">
                <label for="whiskeyName">Whiskey</label>
                <input id="whiskeyName" type="text" placeholder="e.g., Fountain Run 7-Year BIB" />
              </div>
              <div class="field">
                <label for="distillery">Distillery / Brand</label>
                <input id="distillery" type="text" placeholder="e.g., MGP, Buffalo Trace" />
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label for="age">Age (Years)</label>
                <input id="age" type="number" min="0" step="1" placeholder="e.g., 7" />
              </div>
              <div class="field">
                <label for="proof">Proof</label>
                <input id="proof" type="number" min="0" step="0.1" placeholder="e.g., 100" />
              </div>
            </div>

            <div class="field-group">
              <div class="field">
                <label for="batch">Barrel / Batch</label>
                <input id="batch" type="text" placeholder="e.g., Barrel #12, Batch 3" />
              </div>
              <div class="field">
                <label for="price">Price (Pour / Bottle)</label>
                <input id="price" type="text" placeholder="$18 / $89" />
              </div>
            </div>

            <section class="notes-section" style="margin-bottom: 10px;">
              <div class="section-title">Tasting Notes</div>
              <div class="notes-grid">
                <div class="notes-row">
                  <div class="notes-label-pill">Nose</div>
                  <textarea id="nose" placeholder="Aromas, first impression, sweetness, spice, fruit, oak..."></textarea>
                </div>
                <div class="notes-row">
                  <div class="notes-label-pill">Palate</div>
                  <textarea id="palate" placeholder="Flavor profile on the palate, mouthfeel, layers..."></textarea>
                </div>
                <div class="notes-row">
                  <div class="notes-label-pill">Finish</div>
                  <textarea id="finish" placeholder="Length of finish, aftertaste, heat, lingering notes..."></textarea>
                </div>
                <div class="notes-row">
                  <div class="notes-label-pill">Other</div>
                  <textarea id="other" placeholder="Pairing ideas, setting, who youâ€™d share it with, etc."></textarea>
                </div>
              </div>
            </section>

            <!-- Overall rating in left column -->
            <section class="metrics-section">
              <div class="section-title">Overall Rating</div>

              <div class="field" style="margin-bottom: 6px;">
                <label for="rating">Score (0â€“10)</label>
                <select id="rating">
                  <option value="">Select...</option>
                  <option>10 - Unreal / Must Hunt</option>
                  <option>9 - Exceptional</option>
                  <option>8 - Great</option>
                  <option>7 - Very Good</option>
                  <option>6 - Solid</option>
                  <option>5 - Average</option>
                  <option>4 - Below Average</option>
                  <option>3 - Pass</option>
                  <option>2 - Hard Pass</option>
                  <option>1 - Drain Pour</option>
                </select>
              </div>

              <div class="summary-chip-row" id="summaryChips">
                <!-- Summary chips auto-populated -->
              </div>
            </section>
          </section>

          <!-- RIGHT COLUMN â€“ FLAVOR PROFILE & METRICS -->
          <section>
            <section class="metrics-section">
              <!-- Flavor profile header + chart -->
              <div class="flavor-profile-header">
                <div class="flavor-profile-label">Flavor Profile</div>
                <div class="flavor-profile-title" id="flavorProfileTitle">Balanced</div>
              </div>

              <div class="flavor-chart">
                <svg id="flavorChart" viewBox="0 0 600 200" preserveAspectRatio="none"></svg>
                <div class="flavor-chart-labels">
                  <span>Smoky</span>
                  <span>Spicy</span>
                  <span>Herbal</span>
                  <span>Full</span>
                  <span>Rich</span>
                  <span>Sweet</span>
                  <span>Vanilla</span>
                  <span>Creamy</span>
                  <span>Oaky</span>
                  <span>Tart</span>
                  <span>Fruity</span>
                  <span>Floral</span>
                </div>
              </div>

              <div class="section-title">Flavor Metrics (0â€“5)</div>

              <div class="metric-row">
                <div class="metric-label">Smoky</div>
                <div>
                  <input id="smoky" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="smokyValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Spicy</div>
                <div>
                  <input id="spicy" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="spicyValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Herbal</div>
                <div>
                  <input id="herbal" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="herbalValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Full</div>
                <div>
                  <input id="fullBody" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="fullBodyValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Rich</div>
                <div>
                  <input id="rich" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="richValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Sweet</div>
                <div>
                  <input id="sweet" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="sweetValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Vanilla</div>
                <div>
                  <input id="vanilla" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="vanillaValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Creamy</div>
                <div>
                  <input id="creamy" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="creamyValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Oaky</div>
                <div>
                  <input id="oaky" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="oakyValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Tart</div>
                <div>
                  <input id="tart" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="tartValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Fruity</div>
                <div>
                  <input id="fruity" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="fruityValue">0</span>/5</div>
                </div>
              </div>

              <div class="metric-row">
                <div class="metric-label">Floral</div>
                <div>
                  <input id="floral" type="range" min="0" max="5" step="1" value="0" />
                  <div class="metric-value"><span id="floralValue">0</span>/5</div>
                </div>
              </div>
            </section>
          </section>
        </div>
      </form>

      <footer>
        DAGS Bourbon &amp; Whiskey Lounge &mdash; Tasting sheet is for personal use only.
      </footer>
    </main>
  </div>

  <script>
    // Slider IDs (one per flavor)
    const sliderConfig = [
      "smoky",
      "spicy",
      "herbal",
      "fullBody",
      "rich",
      "sweet",
      "vanilla",
      "creamy",
      "oaky",
      "tart",
      "fruity",
      "floral"
    ];

    // Hook slider events
    sliderConfig.forEach(function (id) {
      const slider = document.getElementById(id);
      const valueSpan = document.getElementById(id + "Value");
      if (!slider || !valueSpan) return;

      const sync = function () {
        valueSpan.textContent = slider.value;
        // ---------- TASTING HISTORY: SAVE TO LOCALSTORAGE ----------
const TASTING_HISTORY_KEY = "dags_tastings_v1";

// Build an object with all the current tasting sheet data
function getCurrentTastingEntry() {
  const flavors = sliderConfig.reduce((acc, id) => {
    const el = document.getElementById(id);
    acc[id] = el ? Number(el.value) : 0;
    return acc;
  }, {});

  return {
    id: Date.now(),
    createdAt: new Date().toISOString(),

    whiskeyName: document.getElementById("whiskeyName")?.value || "",
    distillery: document.getElementById("distillery")?.value || "",
    age: document.getElementById("age")?.value || "",
    proof: document.getElementById("proof")?.value || "",
    batch: document.getElementById("batch")?.value || "",
    price: document.getElementById("price")?.value || "",

    nose: document.getElementById("nose")?.value || "",
    palate: document.getElementById("palate")?.value || "",
    finish: document.getElementById("finish")?.value || "",
    other: document.getElementById("other")?.value || "",

    rating: document.getElementById("rating")?.value || "",

    // all 0â€“5 slider values
    flavors
  };
}

function loadTastingHistory() {
  try {
    return JSON.parse(localStorage.getItem(TASTING_HISTORY_KEY) || "[]");
  } catch {
    return [];
  }
}

function saveTastingHistory(history) {
  localStorage.setItem(TASTING_HISTORY_KEY, JSON.stringify(history));
}

// Hook up the Save Tasting button (only bind once)
if (!window.dagsTastingSaveBound) {
  window.dagsTastingSaveBound = true;

  document.getElementById("saveBtn")?.addEventListener("click", () => {
    const entry = getCurrentTastingEntry();

    // Don't save a completely blank sheet
    if (!entry.whiskeyName && !entry.distillery && !entry.rating) {
      alert("Fill in at least the whiskey name, distillery, or rating before saving.");
      return;
    }

    const history = loadTastingHistory();
    history.push(entry);
    saveTastingHistory(history);

    alert("Tasting saved to your Whiskey Log Book!");
  });
}
        buildSummary();
      };
      slider.addEventListener("input", sync);
      sync();
    });

    // Draw SVG line based on metrics (12 sliders -> 12 axis points)
    function updateFlavorChart(vals) {
      const svg = document.getElementById("flavorChart");
      if (!svg) return;

      const width = 600;
      const height = 200;
      const topPad = 25;
      const bottomPad = 40;
      const usableHeight = height - topPad - bottomPad;
      const axisCount = sliderConfig.length;
      const yBase = height - bottomPad;

      const points = [];

      for (let i = 0; i < axisCount; i++) {
        const x = (i / (axisCount - 1)) * width;
        const id = sliderConfig[i];
        const value = vals[id] != null ? vals[id] : 0; // 0â€“5
        const ratio = Math.max(0, Math.min(5, value)) / 5;
        const y = yBase - ratio * usableHeight;
        points.push({ x: x, y: y });
      }

      const pathD = points
        .map(function (p, i) {
          return (i === 0 ? "M " : "L ") + p.x + " " + p.y;
        })
        .join(" ");

      // Vertical guides & ticks
      const guides = points
        .map(function (p) {
          return (
            '<line class="profile-guide" x1="' +
            p.x +
            '" y1="' +
            yBase +
            '" x2="' +
            p.x +
            '" y2="' +
            p.y +
            '"></line>'
          );
        })
        .join("");

      const ticks = points
        .map(function (p) {
          return (
            '<line class="profile-tick" x1="' +
            p.x +
            '" y1="' +
            yBase +
            '" x2="' +
            p.x +
            '" y2="' +
            (yBase + 6) +
            '"></line>'
          );
        })
        .join("");

      const circles = points
        .map(function (p) {
          return (
            '<circle class="profile-point" cx="' +
            p.x +
            '" cy="' +
            p.y +
            '"></circle>'
          );
        })
        .join("");

      svg.innerHTML =
        '<path class="profile-line" d="' +
        pathD +
        '"></path>' +
        guides +
        ticks +
        circles;
    }

    // Compute profile title like "FRUITY & SPICY"
    function updateFlavorProfile(vals) {
      const titleEl = document.getElementById("flavorProfileTitle");
      if (!titleEl) return;

      const profiles = [
        { id: "smoky", label: "Smoky" },
        { id: "spicy", label: "Spicy" },
        { id: "herbal", label: "Herbal" },
        { id: "fullBody", label: "Full" },
        { id: "rich", label: "Rich" },
        { id: "sweet", label: "Sweet" },
        { id: "vanilla", label: "Vanilla" },
        { id: "creamy", label: "Creamy" },
        { id: "oaky", label: "Oaky" },
        { id: "tart", label: "Tart" },
        { id: "fruity", label: "Fruity" },
        { id: "floral", label: "Floral" }
      ];

      const sorted = profiles.slice().sort(function (a, b) {
        return (vals[b.id] || 0) - (vals[a.id] || 0);
      });

      const topVal = vals[sorted[0].id] || 0;
      const secondVal = vals[sorted[1].id] || 0;

      let words;
      if (topVal <= 0 && secondVal <= 0) {
        words = "BALANCED";
      } else if (Math.abs(topVal - secondVal) <= 1 && secondVal > 0) {
        words = (sorted[0].label + " & " + sorted[1].label).toUpperCase();
      } else {
        words = sorted[0].label.toUpperCase();
      }

      titleEl.textContent = words;
    }

    // Build chips + update chart + profile
    function buildSummary() {
      const summaryEl = document.getElementById("summaryChips");
      if (!summaryEl) return;

      const vals = sliderConfig.reduce(function (acc, id) {
        const el = document.getElementById(id);
        acc[id] = el ? Number(el.value) : 0;
        return acc;
      }, {});

      const chips = [];

      if (vals.smoky >= 4) chips.push("Smoky");
      if (vals.spicy >= 4) chips.push("Spicy");
      if (vals.herbal >= 4) chips.push("Herbal");
      if (vals.fullBody >= 4) chips.push("Full-bodied");
      if (vals.rich >= 4) chips.push("Rich");
      if (vals.sweet >= 4) chips.push("Sweet");
      if (vals.vanilla >= 4) chips.push("Vanilla notes");
      if (vals.creamy >= 4) chips.push("Creamy");
      if (vals.oaky >= 4) chips.push("Oaky");
      if (vals.tart >= 4) chips.push("Tart / Bright");
      if (vals.fruity >= 4) chips.push("Fruity");
      if (vals.floral >= 4) chips.push("Floral");

      summaryEl.innerHTML = chips
        .map(function (c) {
          return '<span class="chip">' + c + "</span>";
        })
        .join("");

      updateFlavorChart(vals);
      updateFlavorProfile(vals);
    }

    // Print button
    document.getElementById("printBtn")?.addEventListener("click", function () {
      window.print();
    });

    // Clear button
    document.getElementById("clearBtn")?.addEventListener("click", function () {
      const form = document.getElementById("tastingForm");
      if (!form) return;
      form.reset();

      // Reset sliders to 0 and labels to 0
      sliderConfig.forEach(function (id) {
        const slider = document.getElementById(id);
        const valueSpan = document.getElementById(id + "Value");
        if (slider && valueSpan) {
          slider.value = 0;
          valueSpan.textContent = "0";
        }
      });

      buildSummary();
    });

    // Initial draw
    buildSummary();
  </script>
</body>
</html>
